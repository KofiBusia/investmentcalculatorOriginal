<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Specialized Industry Metrics Calculator - Young Investor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#818cf8',
                        accent: '#a5b4fc',
                        dark: '#1e293b',
                        light: '#f8fafc',
                        success: '#10b981',
                        info: '#0ea5e9',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #f0f4f8 0%, #e6e9ff 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        .card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        .input-field {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            border-color: #a5b4fc;
            box-shadow: 0 0 0 4px rgba(165, 180, 252, 0.25);
        }
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #1e293b;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .nav-button {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            background: white;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .nav-button.home {
            background: #4f46e5;
            color: white;
        }
        .nav-button.calculators {
            background: #10b981;
            color: white;
        }
        .nav-button i {
            margin-right: 8px;
        }
        .target-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4f46e5;
            margin: 10px 0;
        }
        .target-interpretation {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            background-color: #f0f9ff;
            border-left: 4px solid #0ea5e9;
        }
        .formula {
            font-family: 'Courier New', monospace;
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #1e293b;
        }
        td {
            color: #374151;
        }
        select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            transition: all 0.3s ease;
        }
        select:focus {
            border-color: #a5b4fc;
            box-shadow: 0 0 0 4px rgba(165, 180, 252, 0.25);
        }
    </style>
</head>
<body class="text-gray-800">
    <header class="gradient-bg text-white py-8 px-4 md:px-8">
        <div class="max-w-6xl mx-auto">
            <nav class="hidden md:flex justify-between items-center mb-6">
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-white hover:text-indigo-200 transition-colors">Home</a>
                    <a href="/#calculators" class="text-white font-medium border-b-2 border-white">Calculators</a>
                    <a href="/help" class="text-white hover:text-indigo-200 transition-colors">Help Center</a>
                    <a href="/articles" class="text-white hover:text-indigo-200 transition-colors">Resources</a>
                </div>
                <a href="/help" class="bg-white text-primary px-4 py-2 rounded-lg font-medium hover:bg-indigo-50 transition-colors">Get Started</a>
            </nav>
            <div class="max-w-3xl">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">Specialized Industry Metrics Calculator</h1>
                <p class="text-xl md:text-2xl text-indigo-100 mb-6">Calculate leverage, growth, and industry-specific metrics for valuation analysis.</p>
                <div class="flex flex-wrap gap-3">
                    <div class="bg-white/20 px-4 py-2 rounded-full flex items-center">
                        <i class="fas fa-lightbulb mr-2"></i>
                        <span>Beginner Friendly</span>
                    </div>
                    <div class="bg-white/20 px-4 py-2 rounded-full flex items-center">
                        <i class="fas fa-download mr-2"></i>
                        <span>Downloadable Guide</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="nav-buttons mb-6">
            <a href="/" class="nav-button home"><i class="fas fa-home"></i> Return to Home</a>
            <a href="/#calculators" class="nav-button calculators"><i class="fas fa-calculator"></i> Other Calculators</a>
        </div>

        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Calculate Industry Metrics</h2>
            <p class="text-gray-600 mb-6">Select a metric and enter data for a single period or quarter. All monetary values in Ghanaian Cedi (GHS). Add more periods for advanced analysis.</p>
            <div class="formula">
                <p class="text-lg font-semibold">Select Metric</p>
                <select id="formula-select" name="formula" class="mt-2 w-full md:w-1/2 mx-auto input-field">
                    <option value="net_debt" {{ 'selected' if form_data.get('formula') == 'net_debt' else '' }}>Net Debt = Total Debt - Cash</option>
                    <option value="net_debt_ebitda" {{ 'selected' if form_data.get('formula') == 'net_debt_ebitda' else '' }}>Net Debt/EBITDA = (Total Debt - Cash) / EBITDA</option>
                    <option value="revenue_growth" {{ 'selected' if form_data.get('formula') == 'revenue_growth' else '' }}>Revenue Growth = [(Current Revenue - Prior Revenue) / Prior Revenue] × 100</option>
                    <option value="eps_growth" {{ 'selected' if form_data.get('formula') == 'eps_growth' else '' }}>EPS Growth = [(Current EPS - Prior EPS) / Prior EPS] × 100</option>
                    <option value="ltm_ebitda" {{ 'selected' if form_data.get('formula') == 'ltm_ebitda' else '' }}>LTM EBITDA = Sum of Last 4 Quarters’ EBITDA</option>
                    <option value="ntm_ebitda" {{ 'selected' if form_data.get('formula') == 'ntm_ebitda' else '' }}>NTM EBITDA = (Current FY × Months Remaining / 12) + (Next FY × Months Passed / 12)</option>
                    <option value="unlevered_pe" {{ 'selected' if form_data.get('formula') == 'unlevered_pe' else '' }}>Unlevered P/E = EV / EBIAT</option>
                    <option value="tev_ebitdar" {{ 'selected' if form_data.get('formula') == 'tev_ebitdar' else '' }}>TEV/EBITDAR = Total Enterprise Value / (EBITDA + Rent Expense)</option>
                    <option value="ev_subscribers" {{ 'selected' if form_data.get('formula') == 'ev_subscribers' else '' }}>EV/Subscribers = Enterprise Value / Number of Subscribers</option>
                    <option value="ev_boe" {{ 'selected' if form_data.get('formula') == 'ev_boe' else '' }}>EV/BOE = Enterprise Value / Barrels of Oil Equivalent</option>
                    <option value="ev_square_foot" {{ 'selected' if form_data.get('formula') == 'ev_square_foot' else '' }}>EV/Square Foot = Enterprise Value / Total Square Footage</option>
                    <option value="ev_mau" {{ 'selected' if form_data.get('formula') == 'ev_mau' else '' }}>EV/MAU = Enterprise Value / Monthly Active Users</option>
                    <option value="p_ffo" {{ 'selected' if form_data.get('formula') == 'p_ffo' else '' }}>P/FFO = Share Price / Funds From Operations Per Share</option>
                    <option value="p_tbv" {{ 'selected' if form_data.get('formula') == 'p_tbv' else '' }}>P/TBV = Share Price / Tangible Book Value Per Share</option>
                </select>
                <p id="formula-description" class="text-sm mt-2 text-gray-600">{{ form_data.get('formula_description', 'Net Debt measures a company’s debt after accounting for cash holdings.') }}</p>
            </div>
            <form id="specialized-industry-form" class="space-y-6" action="/specialized" method="POST">
                <input type="hidden" name="num_periods" id="num-periods" value="{{ form_data.get('num_periods', '1') }}">
                <div id="annual-inputs" class="space-y-6">
                    {% for i in range(1, (form_data.get('num_periods', '1') | int) + 1) %}
                    <div class="bg-indigo-50 p-4 rounded-lg period-section {{ '' if i <= (form_data.get('num_periods', '1') | int) else 'hidden' }}" id="period-{{ i }}-section" data-period="{{ i }}">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Period {{ i }}</h3>
                            {% if i > 1 %}
                            <button type="button" class="remove-period text-red-500 hover:text-red-700" data-period="{{ i }}"><i class="fas fa-trash"></i></button>
                            {% endif %}
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 dynamic-inputs"></div>
                    </div>
                    {% endfor %}
                </div>
                <div id="quarterly-inputs" class="space-y-6 {{ 'hidden' if form_data.get('formula', 'net_debt') != 'ltm_ebitda' else '' }}">
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Quarterly Data</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Q1 EBITDA ({{ currency_symbol }})</label>
                                <input type="number" step="any" name="ebitda_q1" placeholder="e.g., 50000000" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('ebitda_q1', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Quarterly EBITDA from income statement.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="ebitda_q1-error">Please enter a valid number.</div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Q2 EBITDA ({{ currency_symbol }})</label>
                                <input type="number" step="any" name="ebitda_q2" placeholder="e.g., 52000000" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('ebitda_q2', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Quarterly EBITDA from income statement.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="ebitda_q2-error">Please enter a valid number.</div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Q3 EBITDA ({{ currency_symbol }})</label>
                                <input type="number" step="any" name="ebitda_q3" placeholder="e.g., 51000000" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('ebitda_q3', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Quarterly EBITDA from income statement.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="ebitda_q3-error">Please enter a valid number.</div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Q4 EBITDA ({{ currency_symbol }})</label>
                                <input type="number" step="any" name="ebitda_q4" placeholder="e.g., 53000000" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('ebitda_q4', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Quarterly EBITDA from income statement.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="ebitda_q4-error">Please enter a valid number.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="ntm-inputs" class="space-y-6 {{ 'hidden' if form_data.get('formula', 'net_debt') != 'ntm_ebitda' else '' }}">
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">NTM Projections</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Current FY EBITDA Estimate ({{ currency_symbol }})</label>
                                <input type="number" step="any" name="current_fy_ebitda" placeholder="e.g., 200000000" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('current_fy_ebitda', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Current fiscal year EBITDA estimate from analyst reports.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="current_fy_ebitda-error">Please enter a valid number.</div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Next FY EBITDA Estimate ({{ currency_symbol }})</label>
                                <input type="number" step="any" name="next_fy_ebitda" placeholder="e.g., 220000000" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('next_fy_ebitda', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Next fiscal year EBITDA estimate from analyst reports.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="next_fy_ebitda-error">Please enter a valid number.</div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Months Remaining</label>
                                <input type="number" step="any" name="months_remaining" placeholder="e.g., 6" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('months_remaining', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Months remaining in the current fiscal year.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="months_remaining-error">Please enter a valid number.</div>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Months Passed</label>
                                <input type="number" step="any" name="months_passed" placeholder="e.g., 6" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('months_passed', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">Months passed in the next fiscal year.</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="months_passed-error">Please enter a valid number.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-4">
                    <button type="button" id="add-period" class="px-6 py-3 bg-secondary text-white rounded-lg font-medium hover:bg-indigo-500 transition-colors"><i class="fas fa-plus mr-2"></i> Add Another Period</button>
                    <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors"><i class="fas fa-calculator mr-2"></i> Calculate</button>
                    <button type="reset" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors"><i class="fas fa-eraser mr-2"></i> Clear</button>
                </div>
            </form>
            {% if error %}
            <div id="error-message" class="mt-6">
                <div class="bg-red-50 p-4 rounded-lg">
                    <p class="text-red-700 font-medium" id="error-text">{{ error }}</p>
                </div>
            </div>
            {% endif %}
            {% if results %}
            <div id="results-section" class="mt-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Calculation Results</h3>
                <div class="text-center mb-6">
                    <p class="text-gray-600" id="results-title">Results for {{ form_data.get('num_periods', '1') }} Period(s)</p>
                    <div class="target-price" id="metrics-average-result">
                        {% if form_data.get('formula') in ['revenue_growth', 'eps_growth'] %}
                            {{ (results | sum(attribute='result') / results | length) | float | format_number }}%
                        {% elif form_data.get('formula') in ['net_debt', 'ltm_ebitda', 'ntm_ebitda'] %}
                            {{ currency_symbol }}{{ (results | sum(attribute='result') / results | length) | float | format_number }}
                        {% else %}
                            {{ (results | sum(attribute='result') / results | length) | float | format_number }}x
                        {% endif %}
                    </div>
                    <div class="target-interpretation">
                        <p class="font-medium">Interpretation:</p>
                        <p id="target-interpretation-text">
                            The {{ form_data.get('formula_title', 'Metric') }} reflects
                            {% if form_data.get('formula') in ['net_debt', 'net_debt_ebitda'] %}leverage
                            {% elif form_data.get('formula') in ['revenue_growth', 'eps_growth'] %}growth
                            {% else %}valuation{% endif %}
                            for the period(s).
                        </p>
                    </div>
                </div>
                <table id="results-table">
                    <thead id="results-table-head">
                        {% if form_data.get('formula') == 'ltm_ebitda' %}
                        <tr>
                            <th>Quarter</th>
                            <th>EBITDA ({{ currency_symbol }})</th>
                            <th>LTM EBITDA ({{ currency_symbol }})</th>
                        </tr>
                        {% elif form_data.get('formula') == 'ntm_ebitda' %}
                        <tr>
                            <th>Current FY EBITDA ({{ currency_symbol }})</th>
                            <th>Next FY EBITDA ({{ currency_symbol }})</th>
                            <th>Months Remaining</th>
                            <th>Months Passed</th>
                            <th>NTM EBITDA ({{ currency_symbol }})</th>
                        </tr>
                        {% else %}
                        <tr>
                            <th>Period</th>
                            {% for field in input_fields[form_data.get('formula')] %}
                            <th>{{ field_labels[field].label }}</th>
                            {% endfor %}
                            <th>{{ form_data.get('formula_title', 'Metric') }}
                                {% if form_data.get('formula') in ['revenue_growth', 'eps_growth'] %}(%)
                                {% elif form_data.get('formula') in ['net_debt', 'ltm_ebitda', 'ntm_ebitda'] %}({{ currency_symbol }})
                                {% else %}(x){% endif %}
                            </th>
                        </tr>
                        {% endif %}
                    </thead>
                    <tbody id="metrics-results-table">
                        {% if form_data.get('formula') == 'ltm_ebitda' %}
                        {% for i in range(1, 5) %}
                        <tr>
                            <td>Q{{ i }}</td>
                            <td>{{ currency_symbol }}{{ form_data.get('ebitda_q' + i|string) | float | format_number }}</td>
                            {% if loop.last %}
                            <td>{{ currency_symbol }}{{ results[0].result | float | format_number }}</td>
                            {% else %}
                            <td>-</td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                        {% elif form_data.get('formula') == 'ntm_ebitda' %}
                        <tr>
                            <td>{{ currency_symbol }}{{ form_data.get('current_fy_ebitda') | float | format_number }}</td>
                            <td>{{ currency_symbol }}{{ form_data.get('next_fy_ebitda') | float | format_number }}</td>
                            <td>{{ form_data.get('months_remaining') | float | format_number }}</td>
                            <td>{{ form_data.get('months_passed') | float | format_number }}</td>
                            <td>{{ currency_symbol }}{{ results[0].result | float | format_number }}</td>
                        </tr>
                        {% else %}
                        {% for row in results %}
                        <tr>
                            <td>Period {{ row.period }}</td>
                            {% for field in input_fields[form_data.get('formula')] %}
                            <td>
                                {% if field in ['eps', 'share_price', 'tangible_bvps', 'ffo_per_share'] %}
                                    {{ currency_symbol }}{{ row[field] | float | format_number }}
                                {% elif field == 'tax_rate' %}
                                    {{ row[field] | float | format_number }}%
                                {% else %}
                                    {{ currency_symbol }}{{ row[field] | float | format_number }}
                                {% endif %}
                            </td>
                            {% endfor %}
                            <td>
                                {% if form_data.get('formula') in ['revenue_growth', 'eps_growth'] %}
                                    {{ row.result | float | format_number }}%
                                {% elif form_data.get('formula') in ['net_debt', 'ltm_ebitda', 'ntm_ebitda'] %}
                                    {{ currency_symbol }}{{ row.result | float | format_number }}
                                {% else %}
                                    {{ row.result | float | format_number }}x
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
                <p class="text-gray-600 mt-4">Compare these metrics with industry peers for valuation insights.</p>
                <button id="reset-calculator" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium flex items-center inline-block mt-6"><i class="fas fa-redo mr-2"></i> Calculate Another</button>
            </div>
            {% endif %}
        </div>

        <div class="card p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Understanding Industry Metrics</h2>
            <p class="text-gray-600 mb-6">These metrics help assess leverage, growth, and valuation for industries like tech, energy, and real estate.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-blue-50 p-5 rounded-lg">
                    <div class="text-3xl font-bold text-blue-700 mb-2">Low Metrics</div>
                    <h3 class="font-bold text-gray-800 mb-2">e.g., Net Debt/EBITDA &lt; 2x</h3>
                    <p class="text-gray-600">May indicate lower leverage or undervaluation.</p>
                </div>
                <div class="bg-orange-50 p-5 rounded-lg">
                    <div class="text-3xl font-bold text-orange-700 mb-2">High Metrics</div>
                    <h3 class="font-bold text-gray-800 mb-2">e.g., Net Debt/EBITDA &gt; 4x</h3>
                    <p class="text-gray-600">May indicate high leverage or growth expectations.</p>
                </div>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mt-8 mb-4">How to Use</h3>
            <ol class="list-decimal pl-6 space-y-4">
                <li><strong>Select Metric</strong><p>Choose a metric like Net Debt or EV/Subscribers.</p></li>
                <li><strong>Enter Data</strong><p>Input required financial data for the period.</p></li>
                <li><strong>Add Periods</strong><p>Add up to 5 periods for multi-period analysis (except for LTM/NTM EBITDA).</p></li>
                <li><strong>Calculate</strong><p>Click “Calculate” to see results and interpretation.</p></li>
            </ol>
            <div class="flex flex-wrap gap-3 mt-6">
                <a href="/download_guide" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium flex items-center"><i class="fas fa-download mr-2"></i> Download Guide</a>
                <a href="/tutorial" class="px-4 py-2 bg-primary text-white rounded-lg font-medium flex items-center"><i class="fas fa-play-circle mr-2"></i> Watch Tutorial</a>
            </div>
        </div>

        <div class="card p-6 mb-8">
            <button type="button" onclick="toggleHelpSection()" class="w-full text-left text-2xl font-bold text-gray-800 flex justify-between items-center focus:outline-none">
                <span>How to Find Data</span>
                <span id="help-toggle-icon" class="text-gray-500 text-xl">➕</span>
            </button>
            <div id="help-section" class="hidden mt-4 text-gray-600">
                <p class="mb-2">To calculate these metrics, gather data from:</p>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>Financial Statements</strong>: Balance sheet (debt, cash), income statement (EBITDA, revenue).</li>
                    <li><strong>Market Data</strong>: Share price, market cap from Yahoo Finance or gse.com.gh.</li>
                    <li><strong>Industry Reports</strong>: Subscribers, BOE, MAU from company filings.</li>
                    <li><strong>Analyst Estimates</strong>: NTM projections from Yahoo Finance “Analysis” tab.</li>
                </ul>
            </div>
        </div>

        <div class="nav-buttons mt-6">
            <a href="/" class="nav-button home"><i class="fas fa-home"></i> Return to Home</a>
            <a href="/#calculators" class="nav-button calculators"><i class="fas fa-calculator"></i> Other Calculators</a>
        </div>
    </div>

    <footer class="bg-dark text-white py-12">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">InvestIQ</h3>
                    <p class="text-gray-400 mb-4">Empowering investors with advanced tools, insights, and calculators to make smarter financial decisions.</p>
                    <div class="flex gap-3">
                        <a href="#" class="w-10 h-10 bg-gray-800 text-white rounded-full flex items-center justify-center hover:bg-primary transition-colors"><i class="fab fa-x-twitter"></i></a>
                        <a href="#" class="w-10 h-10 bg-gray-800 text-white rounded-full flex items-center justify-center hover:bg-primary transition-colors"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" class="w-10 h-10 bg-gray-800 text-white rounded-full flex items-center justify-center hover:bg-primary transition-colors"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="w-10 h-10 bg-gray-800 text-white rounded-full flex items-center justify-center hover:bg-primary transition-colors"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="/#calculators" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-calculator mr-2"></i> Calculators</a></li>
                        <li><a href="/help" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-question-circle mr-2"></i> Help Center</a></li>
                        <li><a href="/about" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-info-circle mr-2"></i> About Us</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Resources</h3>
                    <ul class="space-y-2">
                        <li><a href="/non_portfolio_risk_help" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-book mr-2"></i> Non-Portfolio Risk Guide</a></li>
                        <li><a href="/portfolio_risk_help" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-book mr-2"></i> Portfolio Risk Guide</a></li>
                        <li><a href="/bond_risk_help" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-book mr-2"></i> Bond Risk Guide</a></li>
                        <li><a href="/contact" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-envelope mr-2"></i> Contact Us</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Contact</h3>
                    <ul class="space-y-2">
                        <li><a href="mailto:info@cleanvisionhr.com" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-envelope mr-2"></i> info@cleanvisionhr.com</a></li>
                        <li><a href="tel:+233503566913" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-phone mr-2"></i> +233 50 356 6913</a></li>
                        <li><a href="/contact" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-map-marker-alt mr-2"></i> Contact Form</a></li>
                        <li><a href="/faq" class="text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-question-circle mr-2"></i> FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-6 text-center">
                <p class="text-gray-400">© 2025 InvestIQ. All rights reserved. | <a href="/privacy" class="text-gray-400 hover:text-white">Privacy Policy</a> | <a href="/terms" class="text-gray-400 hover:text-white">Terms of Service</a></p>
            </div>
        </div>
    </footer>

    <button id="backToTop" class="back-to-top w-12 h-12 bg-primary text-white rounded-full shadow-lg flex items-center justify-center">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        function formatNumber(value) {
            return parseFloat(value).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        const backToTopBtn = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            backToTopBtn.classList.toggle('visible', window.scrollY > 300);
        });
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        const formulaSelect = document.getElementById('formula-select');
        const formulaDescription = document.getElementById('formula-description');
        const annualInputs = document.getElementById('annual-inputs');
        const quarterlyInputs = document.getElementById('quarterly-inputs');
        const ntmInputs = document.getElementById('ntm-inputs');
        const form = document.getElementById('specialized-industry-form');
        const resultsSection = document.getElementById('results-section');
        const metricsAverageResult = document.getElementById('metrics-average-result');
        const metricsResultsTable = document.getElementById('metrics-results-table');
        const resultsTableHead = document.getElementById('results-table-head');
        const resultsTitle = document.getElementById('results-title');
        const targetInterpretationText = document.getElementById('target-interpretation-text');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const resetBtn = document.getElementById('reset-calculator');
        const addPeriodBtn = document.getElementById('add-period');
        const numPeriodsInput = document.getElementById('num-periods');

        let periodCount = parseInt(numPeriodsInput?.value) || 1;
        const maxPeriods = 5;

        const inputFields = {
            net_debt: ['total_debt', 'cash'],
            net_debt_ebitda: ['total_debt', 'cash', 'ebitda'],
            revenue_growth: ['revenue', 'prior_revenue'],
            eps_growth: ['eps', 'prior_eps'],
            ltm_ebitda: [],
            ntm_ebitda: [],
            unlevered_pe: ['market_cap', 'total_debt', 'preferred_stock', 'minority_interest', 'cash', 'non_operating_assets', 'ebit', 'tax_rate'],
            tev_ebitdar: ['market_cap', 'total_debt', 'preferred_stock', 'minority_interest', 'cash', 'non_operating_assets', 'ebitda', 'rent_expense'],
            ev_subscribers: ['market_cap', 'total_debt', 'preferred_stock', 'minority_interest', 'cash', 'non_operating_assets', 'subscribers'],
            ev_boe: ['market_cap', 'total_debt', 'preferred_stock', 'minority_interest', 'cash', 'non_operating_assets', 'boe'],
            ev_square_foot: ['market_cap', 'total_debt', 'preferred_stock', 'minority_interest', 'cash', 'non_operating_assets', 'square_footage'],
            ev_mau: ['market_cap', 'total_debt', 'preferred_stock', 'minority_interest', 'cash', 'non_operating_assets', 'mau'],
            p_ffo: ['share_price', 'ffo_per_share'],
            p_tbv: ['share_price', 'tangible_bvps']
        };

        const fieldLabels = {
            market_cap: { label: 'Market Capitalization ({{ currency_symbol }})', placeholder: 'e.g., 1000000000', tooltip: 'Share Price × Shares Outstanding from Yahoo Finance or gse.com.gh.' },
            total_debt: { label: 'Total Debt ({{ currency_symbol }})', placeholder: 'e.g., 500000000', tooltip: 'Total liabilities (short-term + long-term debt) from balance sheet.' },
            preferred_stock: { label: 'Preferred Stock ({{ currency_symbol }})', placeholder: 'e.g., 0', tooltip: 'Value of preferred shares from balance sheet, if applicable.' },
            minority_interest: { label: 'Minority Interest ({{ currency_symbol }})', placeholder: 'e.g., 0', tooltip: 'Value of minority interest from balance sheet, if applicable.' },
            cash: { label: 'Cash and Cash Equivalents ({{ currency_symbol }})', placeholder: 'e.g., 200000000', tooltip: 'Cash and equivalents from balance sheet.' },
            non_operating_assets: { label: 'Non-Operating Assets ({{ currency_symbol }})', placeholder: 'e.g., 0', tooltip: 'Non-operating assets (e.g., investments) from balance sheet.' },
            ebitda: { label: 'EBITDA ({{ currency_symbol }})', placeholder: 'e.g., 200000000', tooltip: 'Earnings before interest, taxes, depreciation, and amortization from income statement.' },
            ebit: { label: 'EBIT ({{ currency_symbol }})', placeholder: 'e.g., 150000000', tooltip: 'Earnings before interest and taxes from income statement.' },
            revenue: { label: 'Revenue ({{ currency_symbol }})', placeholder: 'e.g., 500000000', tooltip: 'Total sales or revenue from income statement.' },
            prior_revenue: { label: 'Prior Revenue ({{ currency_symbol }})', placeholder: 'e.g., 450000000', tooltip: 'Revenue from the prior period for growth calculation.' },
            eps: { label: 'Earnings Per Share (EPS) ({{ currency_symbol }})', placeholder: 'e.g., 1.25', tooltip: 'Net income divided by shares outstanding from income statement.' },
            prior_eps: { label: 'Prior EPS ({{ currency_symbol }})', placeholder: 'e.g., 1.00', tooltip: 'EPS from the prior period for growth calculation.' },
            tax_rate: { label: 'Tax Rate (%)', placeholder: 'e.g., 25', tooltip: 'Effective tax rate from income statement or analyst estimates.' },
            rent_expense: { label: 'Rent Expense ({{ currency_symbol }})', placeholder: 'e.g., 5000000', tooltip: 'Annual rent expense from income statement or notes.' },
            subscribers: { label: 'Subscribers', placeholder: 'e.g., 1000000', tooltip: 'Number of subscribers from company reports (SaaS/Tech).' },
            boe: { label: 'Barrels of Oil Equivalent (BOE)', placeholder: 'e.g., 1000000', tooltip: 'Barrels of oil equivalent from energy company filings.' },
            square_footage: { label: 'Square Footage', placeholder: 'e.g., 500000', tooltip: 'Total square footage from real estate company reports.' },
            mau: { label: 'Monthly Active Users (MAU)', placeholder: 'e.g., 10000000', tooltip: 'Monthly active users from social media/tech company reports.' },
            ffo_per_share: { label: 'FFO Per Share ({{ currency_symbol }})', placeholder: 'e.g., 2.50', tooltip: 'Funds from operations per share from real estate company reports.' },
            tangible_bvps: { label: 'Tangible Book Value Per Share ({{ currency_symbol }})', placeholder: 'e.g., 4.00', tooltip: 'Tangible book value per share from balance sheet.' },
            share_price: { label: 'Share Price ({{ currency_symbol }})', placeholder: 'e.g., 10.50', tooltip: 'Current market price per share from Yahoo Finance or gse.com.gh.' }
        };

        const formulaDescriptions = {
            net_debt: 'Net Debt measures a company’s debt after accounting for cash holdings.',
            net_debt_ebitda: 'Net Debt/EBITDA measures leverage relative to earnings.',
            revenue_growth: 'Revenue Growth measures the percentage increase in revenue from the prior period.',
            eps_growth: 'EPS Growth measures the percentage increase in earnings per share from the prior period.',
            ltm_ebitda: 'LTM EBITDA sums the EBITDA of the last 4 quarters.',
            ntm_ebitda: 'NTM EBITDA estimates the next 12 months’ EBITDA based on projections.',
            unlevered_pe: 'Unlevered P/E measures enterprise value relative to after-tax operating earnings.',
            tev_ebitdar: 'TEV/EBITDAR measures total value relative to EBITDA plus rent expense.',
            ev_subscribers: 'EV/Subscribers measures enterprise value per subscriber for SaaS/tech companies.',
            ev_boe: 'EV/BOE measures enterprise value per barrel of oil equivalent for energy companies.',
            ev_square_foot: 'EV/Square Foot measures enterprise value per square foot for real estate.',
            ev_mau: 'EV/MAU measures enterprise value per monthly active user for social media/tech.',
            p_ffo: 'P/FFO measures share price relative to funds from operations per share for real estate.',
            p_tbv: 'P/TBV measures share price relative to tangible book value per share for financials.'
        };

        const formulaTitles = {
            net_debt: 'Net Debt',
            net_debt_ebitda: 'Net Debt/EBITDA',
            revenue_growth: 'Revenue Growth',
            eps_growth: 'EPS Growth',
            ltm_ebitda: 'LTM EBITDA',
            ntm_ebitda: 'NTM EBITDA',
            unlevered_pe: 'Unlevered P/E',
            tev_ebitdar: 'TEV/EBITDAR',
            ev_subscribers: 'EV/Subscribers',
            ev_boe: 'EV/BOE',
            ev_square_foot: 'EV/Square Foot',
            ev_mau: 'EV/MAU',
            p_ffo: 'P/FFO',
            p_tbv: 'P/TBV'
        };

        function renderPeriodInputs() {
            const selectedFormula = formulaSelect.value;
            periodCount = parseInt(numPeriodsInput.value) || 1;
            formulaDescription.textContent = formulaDescriptions[selectedFormula];
            annualInputs.classList.toggle('hidden', selectedFormula === 'ltm_ebitda' || selectedFormula === 'ntm_ebitda');
            quarterlyInputs.classList.toggle('hidden', selectedFormula !== 'ltm_ebitda');
            ntmInputs.classList.toggle('hidden', selectedFormula !== 'ntm_ebitda');
            annualInputs.innerHTML = '';
            for (let i = 1; i <= periodCount; i++) {
                const periodSection = document.createElement('div');
                periodSection.className = `bg-indigo-50 p-4 rounded-lg period-section ${i > periodCount ? 'hidden' : ''}`;
                periodSection.id = `period-${i}-section`;
                periodSection.setAttribute('data-period', i);
                periodSection.innerHTML = `
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Period ${i}</h3>
                        ${i > 1 ? `<button type="button" class="remove-period text-red-500 hover:text-red-700" data-period="${i}"><i class="fas fa-trash"></i></button>` : ''}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 dynamic-inputs"></div>
                `;
                const dynamicInputs = periodSection.querySelector('.dynamic-inputs');
                if (selectedFormula !== 'ltm_ebitda' && selectedFormula !== 'ntm_ebitda') {
                    inputFields[selectedFormula].forEach(field => {
                        const { label, placeholder, tooltip } = fieldLabels[field];
                        dynamicInputs.insertAdjacentHTML('beforeend', `
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">${label.replace('{{ currency_symbol }}', '{{ currency_symbol }}')}</label>
                                <input type="number" step="any" name="${field}_${i}" placeholder="${placeholder}" class="input-field w-full h-12 px-4 py-3 rounded-lg shadow-sm" value="{{ form_data.get('${field}_${i}', '') }}">
                                <div class="tooltip mt-2"><i class="fas fa-info-circle text-gray-500"></i><span class="tooltiptext">${tooltip}</span></div>
                                <div class="form-error text-danger text-sm mt-2 hidden" id="${field}_${i}-error">Please enter a valid number.</div>
                            </div>
                        `);
                    });
                }
                annualInputs.appendChild(periodSection);
            }
            document.querySelectorAll('.remove-period').forEach(btn => {
                btn.addEventListener('click', () => {
                    const period = parseInt(btn.getAttribute('data-period'));
                    document.getElementById(`period-${period}-section`).remove();
                    periodCount--;
                    numPeriodsInput.value = periodCount;
                    togglePeriodSections();
                });
            });
        }

        function togglePeriodSections() {
            periodCount = parseInt(numPeriodsInput.value) || 1;
            const periodSections = document.querySelectorAll('.period-section');
            periodSections.forEach((section, index) => {
                const period = index + 1;
                section.classList.toggle('hidden', period > periodCount);
                if (period > periodCount) {
                    section.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
                }
            });
        }

        addPeriodBtn.addEventListener('click', () => {
            if (periodCount >= maxPeriods || formulaSelect.value === 'ltm_ebitda' || formulaSelect.value === 'ntm_ebitda') return;
            periodCount++;
            numPeriodsInput.value = periodCount;
            renderPeriodInputs();
        });

        formulaSelect.addEventListener('change', () => {
            periodCount = 1;
            numPeriodsInput.value = periodCount;
            renderPeriodInputs();
        });

        function calculateMetric(data, formula) {
            const ev = (data.market_cap || 0) + (data.total_debt || 0) + (data.preferred_stock || 0) + (data.minority_interest || 0) - (data.cash || 0) - (data.non_operating_assets || 0);
            switch (formula) {
                case 'net_debt': return data.total_debt - data.cash;
                case 'net_debt_ebitda': return data.ebitda ? (data.total_debt - data.cash) / data.ebitda : null;
                case 'revenue_growth': return data.prior_revenue ? ((data.revenue - data.prior_revenue) / data.prior_revenue) * 100 : null;
                case 'eps_growth': return data.prior_eps ? ((data.eps - data.prior_eps) / data.prior_eps) * 100 : null;
                case 'ltm_ebitda': return (data.ebitda_q1 || 0) + (data.ebitda_q2 || 0) + (data.ebitda_q3 || 0) + (data.ebitda_q4 || 0);
                case 'ntm_ebitda': return ((data.current_fy_ebitda || 0) * (data.months_remaining || 0) / 12) + ((data.next_fy_ebitda || 0) * (data.months_passed || 0) / 12);
                case 'unlevered_pe': return data.ebit && data.tax_rate != null ? ev / (data.ebit * (1 - data.tax_rate / 100)) : null;
                case 'tev_ebitdar': return data.ebitda && data.rent_expense != null ? ev / (data.ebitda + data.rent_expense) : null;
                case 'ev_subscribers': return data.subscribers ? ev / data.subscribers : null;
                case 'ev_boe': return data.boe ? ev / data.boe : null;
                case 'ev_square_foot': return data.square_footage ? ev / data.square_footage : null;
                case 'ev_mau': return data.mau ? ev / data.mau : null;
                case 'p_ffo': return data.ffo_per_share ? data.share_price / data.ffo_per_share : null;
                case 'p_tbv': return data.tangible_bvps ? data.share_price / data.tangible_bvps : null;
                default: return null;
            }
        }

        function toggleHelpSection() {
            const helpSection = document.getElementById('help-section');
            const toggleIcon = document.getElementById('help-toggle-icon');
            helpSection.classList.toggle('hidden');
            toggleIcon.textContent = helpSection.classList.contains('hidden') ? '➕' : '➖';
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            errorMessage.classList.add('hidden');
            document.querySelectorAll('.form-error').forEach(el => el.classList.add('hidden'));
            const selectedFormula = formulaSelect.value;
            const results = [];
            let valid = true;

            if (selectedFormula === 'ltm_ebitda') {
                const ebitda = [1, 2, 3, 4].map(i => parseFloat(document.querySelector(`[name="ebitda_q${i}"]`)?.value)).filter(val => !isNaN(val));
                if (ebitda.length < 4) {
                    [1, 2, 3, 4].forEach(i => {
                        const input = document.querySelector(`[name="ebitda_q${i}"]`);
                        if (!input || !input.value || isNaN(parseFloat(input.value))) {
                            document.getElementById(`ebitda_q${i}-error`).classList.remove('hidden');
                        }
                    });
                    valid = false;
                    errorText.textContent = 'Please provide valid inputs for all 4 quarters.';
                    errorMessage.classList.remove('hidden');
                } else {
                    results.push({ ebitda_q1: ebitda[0], ebitda_q2: ebitda[1], ebitda_q3: ebitda[2], ebitda_q4: ebitda[3], result: calculateMetric({ ebitda_q1: ebitda[0], ebitda_q2: ebitda[1], ebitda_q3: ebitda[2], ebitda_q4: ebitda[3] }, selectedFormula) });
                }
            } else if (selectedFormula === 'ntm_ebitda') {
                const data = {
                    current_fy_ebitda: parseFloat(document.querySelector('[name="current_fy_ebitda"]')?.value),
                    next_fy_ebitda: parseFloat(document.querySelector('[name="next_fy_ebitda"]')?.value),
                    months_remaining: parseFloat(document.querySelector('[name="months_remaining"]')?.value),
                    months_passed: parseFloat(document.querySelector('[name="months_passed"]')?.value)
                };
                if (Object.values(data).some(val => isNaN(val))) {
                    Object.keys(data).forEach(key => {
                        if (isNaN(data[key])) document.getElementById(`${key}-error`).classList.remove('hidden');
                    });
                    valid = false;
                    errorText.textContent = 'Please provide valid inputs for all NTM fields.';
                    errorMessage.classList.remove('hidden');
                } else {
                    results.push({ ...data, result: calculateMetric(data, selectedFormula) });
                }
            } else {
                for (let i = 1; i <= periodCount; i++) {
                    const data = {};
                    inputFields[selectedFormula].forEach(field => {
                        const input = document.querySelector(`[name="${field}_${i}"]`);
                        data[field] = input ? parseFloat(input.value) : NaN;
                        if (isNaN(data[field])) {
                            document.getElementById(`${field}_${i}-error`).classList.remove('hidden');
                            valid = false;
                        }
                    });
                    if (valid) {
                        data.result = calculateMetric(data, selectedFormula);
                        if (data.result == null || isNaN(data.result)) {
                            valid = false;
                            errorText.textContent = 'Invalid calculation (e.g., division by zero).';
                            errorMessage.classList.remove('hidden');
                        } else {
                            results.push({ period: i, ...data, result: data.result });
                        }
                    }
                }
            }

            if (!valid || results.length === 0) {
                errorText.textContent = errorText.textContent || 'Please provide valid inputs for all required fields.';
                errorMessage.classList.remove('hidden');
                return;
            }

            resultsSection.classList.remove('hidden');
            resultsTitle.textContent = selectedFormula === 'ntm_ebitda' ? 'Results for NTM Projections' : selectedFormula === 'ltm_ebitda' ? 'Results for Last 4 Quarters' : `Results for ${results.length} Period(s)`;
            const unit = ['revenue_growth', 'eps_growth'].includes(selectedFormula) ? '%' : selectedFormula === 'net_debt' || selectedFormula === 'ltm_ebitda' || selectedFormula === 'ntm_ebitda' ? 'GHS' : 'x';
            metricsAverageResult.textContent = `${formatNumber(results.reduce((sum, r) => sum + r.result, 0) / results.length)} ${unit}`;
            targetInterpretationText.textContent = `The ${formulaTitles[selectedFormula]} reflects ${selectedFormula === 'net_debt' || selectedFormula === 'net_debt_ebitda' ? 'leverage' : selectedFormula.includes('growth') ? 'growth' : 'valuation'} for the period(s).`;

            if (selectedFormula === 'ltm_ebitda') {
                resultsTableHead.innerHTML = `<tr><th>Quarter</th><th>EBITDA (GHS)</th><th>LTM EBITDA (GHS)</th></tr>`;
                metricsResultsTable.innerHTML = results.map((row, i) => `
                    <tr>
                        <td>Q${i + 1}</td>
                        <td>GHS ${formatNumber(row[`ebitda_q${i + 1}`])}</td>
                        <td>GHS ${formatNumber(row.result)}</td>
                    </tr>
                `).join('');
            } else if (selectedFormula === 'ntm_ebitda') {
                resultsTableHead.innerHTML = `<tr><th>Current FY EBITDA (GHS)</th><th>Next FY EBITDA (GHS)</th><th>Months Remaining</th><th>Months Passed</th><th>NTM EBITDA (GHS)</th></tr>`;
                metricsResultsTable.innerHTML = results.map(row => `
                    <tr>
                        <td>GHS ${formatNumber(row.current_fy_ebitda)}</td>
                        <td>GHS ${formatNumber(row.next_fy_ebitda)}</td>
                        <td>${formatNumber(row.months_remaining)}</td>
                        <td>${formatNumber(row.months_passed)}</td>
                        <td>GHS ${formatNumber(row.result)}</td>
                    </tr>
                `).join('');
            } else {
                resultsTableHead.innerHTML = `<tr><th>Period</th>${inputFields[selectedFormula].map(field => `<th>${fieldLabels[field].label.replace('{{ currency_symbol }}', 'GHS')}</th>`).join('')}<th>${formulaTitles[selectedFormula]} (${unit})</th></tr>`;
                metricsResultsTable.innerHTML = results.map(row => `
                    <tr>
                        <td>Period ${row.period}</td>
                        ${inputFields[selectedFormula].map(field => `<td>${field.includes('eps') || field.includes('share_price') || field.includes('bvps') ? 'GHS' : field === 'tax_rate' ? '' : 'GHS'} ${formatNumber(row[field])}${field === 'tax_rate' ? '%' : ''}</td>`).join('')}
                        <td>${formatNumber(row.result)}${unit}</td>
                    </tr>
                `).join('');
            }

            resultsSection.scrollIntoView({ behavior: 'smooth' });
        });

        resetBtn.addEventListener('click', () => {
            form.reset();
            periodCount = 1;
            numPeriodsInput.value = periodCount;
            resultsSection.classList.add('hidden');
            errorMessage.classList.add('hidden');
            document.querySelectorAll('.form-error').forEach(el => el.classList.add('hidden'));
            renderPeriodInputs();
        });

        form.addEventListener('reset', () => {
            periodCount = 1;
            numPeriodsInput.value = periodCount;
            resultsSection.classList.add('hidden');
            errorMessage.classList.add('hidden');
            document.querySelectorAll('.form-error').forEach(el => el.classList.add('hidden'));
            renderPeriodInputs();
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', () => {
                    if (input.value === '' || isNaN(parseFloat(input.value))) {
                        input.setCustomValidity('Please enter a valid number.');
                        input.reportValidity();
                    } else {
                        input.setCustomValidity('');
                    }
                });
            });
            renderPeriodInputs();
        });
    </script>
</body>
</html>